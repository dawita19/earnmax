import { Suspense } from "react"
import { getUsers } from "@/actions/admin/users"
import UsersTable from "./components/UsersTable"
import UserFilter from "./components/UserFilter"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { VipLevelDistribution } from "./components/VipLevelDistribution"
import { Skeleton } from "@/components/ui/skeleton"

interface AdminUsersPageProps {
  searchParams: {
    query?: string;
    vip_level?: string;
    page?: string;
  }
}

export default async function AdminUsersPage({ searchParams }: AdminUsersPageProps) {
  const { query, vip_level, page } = searchParams
  const currentPage = Number(page) || 1
  const { users, totalCount } = await getUsers(query, vip_level, currentPage)

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">User Management</h1>
        <div className="flex items-center space-x-2">
          <span className="text-sm text-muted-foreground">
            {totalCount} total users
          </span>
        </div>
      </div>

      <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
        <Card className="lg:col-span-2">
          <CardHeader>
            <CardTitle>Users</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="mb-6">
              <UserFilter />
            </div>
            <UsersTable data={users} />
          </CardContent>
        </Card>

        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle>VIP Distribution</CardTitle>
            </CardHeader>
            <CardContent>
              <Suspense fallback={<Skeleton className="h-[300px] w-full" />}>
                <VipLevelDistribution />
              </Suspense>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Quick Actions</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <Button variant="outline" className="w-full">
                Add New User
              </Button>
              <Button variant="outline" className="w-full">
                Bulk VIP Upgrade
              </Button>
              <Button variant="outline" className="w-full">
                Send Mass Notification
              </Button>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  )
}